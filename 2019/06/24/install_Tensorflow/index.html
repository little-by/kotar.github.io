<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>install_Tensorflow | Kotara</title><meta name="author" content="Kotar Zhang"><meta name="copyright" content="Kotar Zhang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="现在机器学习异常火热，智能大会也在天津进行的如火如荼，英伟达的AI芯大卖股价暴涨，学术界的很多方面也需要结合机器学习来研究一些新内容，有必要搭建一个机器学习框架。Tensorflow是TensorFlow是谷歌基于DistBelief进行研发的第二代人工智能学习系统，现在（写于2018-5-16）已经推出版本1.8。Tensorflow有仅用CPU的版本，这个安装很简单，可以官方参考文档。为了发挥">
<meta property="og:type" content="article">
<meta property="og:title" content="install_Tensorflow">
<meta property="og:url" content="http://little-by.github.io/2019/06/24/install_Tensorflow/index.html">
<meta property="og:site_name" content="Kotara">
<meta property="og:description" content="现在机器学习异常火热，智能大会也在天津进行的如火如荼，英伟达的AI芯大卖股价暴涨，学术界的很多方面也需要结合机器学习来研究一些新内容，有必要搭建一个机器学习框架。Tensorflow是TensorFlow是谷歌基于DistBelief进行研发的第二代人工智能学习系统，现在（写于2018-5-16）已经推出版本1.8。Tensorflow有仅用CPU的版本，这个安装很简单，可以官方参考文档。为了发挥">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://little-by.github.io/img/cover/hr1.jpg">
<meta property="article:published_time" content="2019-06-24T15:36:42.000Z">
<meta property="article:modified_time" content="2021-03-11T11:50:30.000Z">
<meta property="article:author" content="Kotar Zhang">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://little-by.github.io/img/cover/hr1.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://little-by.github.io/2019/06/24/install_Tensorflow/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '5.2.0',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Kotar Zhang","link":"链接: ","source":"来源: Kotara","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  ClickShowText: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2021-03-11 19:50:30'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {
  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }

  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }
})()</script><meta name="generator" content="Hexo 5.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">40</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">23</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div id="body-wrap"><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">一、软硬件条件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Ubuntu-16-04-LTS"><span class="toc-number">1.1.</span> <span class="toc-text">Ubuntu 16.04 LTS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NVIDIA%C2%AE-GPU"><span class="toc-number">1.2.</span> <span class="toc-text">NVIDIA® GPU</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%8F%E6%8F%92%E6%9B%B2"><span class="toc-number">1.2.0.1.</span> <span class="toc-text">小插曲</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NVIDIA%E9%A9%B1%E5%8A%A8"><span class="toc-number">1.3.</span> <span class="toc-text">NVIDIA驱动</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%8D%B8%E8%BD%BD%E5%B7%B2%E6%9C%89%E7%9A%84%E9%A9%B1%E5%8A%A8"><span class="toc-number">1.3.1.</span> <span class="toc-text">1.卸载已有的驱动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%A6%81%E7%94%A8nouveau"><span class="toc-number">1.3.2.</span> <span class="toc-text">2.禁用nouveau</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%BC%80%E5%A7%8B%E5%AE%89%E8%A3%85"><span class="toc-number">1.3.3.</span> <span class="toc-text">3.开始安装</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CUDA%E5%B7%A5%E5%85%B7%E5%8C%859-0"><span class="toc-number">1.4.</span> <span class="toc-text">CUDA工具包9.0</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A6%96%E5%85%88%E8%BF%98%E6%98%AF%E5%88%A0%E9%99%A4%E4%B9%8B%E5%89%8D%E7%9A%84%E5%AE%89%E8%A3%85%E6%96%87%E4%BB%B6"><span class="toc-number">1.4.1.</span> <span class="toc-text">首先还是删除之前的安装文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85CUDA"><span class="toc-number">1.4.2.</span> <span class="toc-text">安装CUDA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%AE%8C%E6%88%90%E5%88%87%E8%AE%B0%E8%A6%81%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">1.4.3.</span> <span class="toc-text">安装完成切记要配置环境变量</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cuDNN-v7-0"><span class="toc-number">1.5.</span> <span class="toc-text">cuDNN v7.0</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#libcupti-dev-%E5%BA%93"><span class="toc-number">1.6.</span> <span class="toc-text">libcupti-dev 库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SUMMARY"><span class="toc-number">1.7.</span> <span class="toc-text">SUMMARY</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">二、安装Tensorflow</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85Anaconda"><span class="toc-number">2.1.</span> <span class="toc-text">安装Anaconda</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85Anaconda-v2"><span class="toc-number">2.1.1.</span> <span class="toc-text">安装Anaconda</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAtensorflow%E7%9A%84conda%E7%8E%AF%E5%A2%83"><span class="toc-number">2.1.2.</span> <span class="toc-text">创建tensorflow的conda环境</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85tensorflow"><span class="toc-number">2.2.</span> <span class="toc-text">安装tensorflow</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E5%AE%89%E8%A3%85"><span class="toc-number">2.3.</span> <span class="toc-text">验证安装</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">更新</span></a></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(/img/cover/hr1.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Kotara</a></span><span id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">install_Tensorflow</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2019-06-24T15:36:42.000Z" title="发表于 2019-06-24 23:36:42">2019-06-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-03-11T11:50:30.000Z" title="更新于 2021-03-11 19:50:30">2021-03-11</time></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><p>现在机器学习异常火热，智能大会也在天津进行的如火如荼，英伟达的AI芯大卖股价暴涨，学术界的很多方面也需要结合机器学习来研究一些新内容，有必要搭建一个机器学习框架。Tensorflow是TensorFlow是谷歌基于DistBelief进行研发的第二代人工智能学习系统，现在（写于2018-5-16）已经推出版本1.8。Tensorflow有仅用CPU的版本，这个安装很简单，可以官方参考文档。为了发挥GPU运算的优势，提高运算速度，这里搭建一个GPU版本的Tensorflow，这个笔记和大家分享，一起学习。</p>
<h1>一、软硬件条件</h1>
<p>这里选择在Ubuntu 16.04 LTS系统（在Ubuntu下可用cat /etc/issue 查看版本号），根据官网的文档，安装GPU版本的Tensorflow需要满足以下先决条件：</p>
<ul>
<li>CUDA® 工具包 9.0。如需了解详情，请参阅 NVIDIA 文档。请务必按照 NVIDIA 文档中的说明将相关的 CUDA 路径名附加到 LD_LIBRARY_PATH 环境变量中。<br>
与 CUDA 工具包 9.0 相关联的 NVIDIA 驱动程序。</li>
<li>cuDNN v7.0。如需了解详情，请参阅 NVIDIA 文档。请务必按照 NVIDIA 文档中的说明创建 CUDA_HOME 环境变量。</li>
<li>CUDA 计算能力为 3.0 或更高的 GPU 卡（用于从源代码构建），以及 CUDA 计算能力为 3.5 或更高的 GPU 卡（用于安装我们的二进制文件）。如需了解支持的 GPU 卡的列表，请参阅 NVIDIA 文档。</li>
<li>libcupti-dev 库，这是 NVIDIA CUDA 分析工具接口。此库提供高级分析支持。要安装此库，请针对 CUDA 工具包 8.0 或更高版本发出以下命令：</li>
</ul>
<blockquote>
<p>$ sudo apt-get install cuda-command-line-tools</p>
</blockquote>
<p>并将其路径添加到您的 LD_LIBRARY_PATH 环境变量中：</p>
<blockquote>
<p>$ export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/cuda/extras/CUPTI/lib64</p>
</blockquote>
<p>对于 CUDA 工具包 7.5 或更低版本，请发出以下命令：</p>
<blockquote>
<p>$ sudo apt-get install libcupti-dev</p>
</blockquote>
<p>接下来一一检查这些条件</p>
<a id="more"></a>
<h2 id="Ubuntu-16-04-LTS"><a class="header-anchor" href="#Ubuntu-16-04-LTS">¶</a>Ubuntu 16.04 LTS</h2>
<p>已经成功安装Ubuntu16.04</p>
<p>发现服务器ping不通外网,在/etc/resolv.conf添加了一行</p>
<blockquote>
<p>nameserver 114.114.114.114</p>
</blockquote>
<p>但是这样重启后会被重写，改用下边这种方法</p>
<blockquote>
<p>sudo vim /etc/resolvconf/resolv.conf.d/base</p>
</blockquote>
<p>添加</p>
<blockquote>
<p>nameserver 114.114.114.114</p>
</blockquote>
<p>本来为了避免安装软件的过程中过慢或者卡死，将系统源替换为国内镜像，可是发现国内的源要不丢包，要不更新慢，最后还是用回了原装，事实证明转装的最好用，不慢还齐全。</p>
<h2 id="NVIDIA®-GPU"><a class="header-anchor" href="#NVIDIA®-GPU">¶</a>NVIDIA® GPU</h2>
<p>首先需要保证有NVIDIA® GPU而且支持CUDA。<br>
发现系统中查不到NVIDIA® GPU，使用lspci和lshw找不到NVIDIA的GPU。可能是驱动的原因？首先安装驱动，去<a target="_blank" rel="noopener" href="https://www.geforce.cn/drivers">英伟达官网</a>下载了最新的驱动NVIDIA-Linux-x86_64-390.48.run</p>
<blockquote>
<p>sudo chmod a+x NVIDIA-Linux-x86_64-390.48.run<br>
sudo ./NVIDIA-Linux-x86_64-390.48.run</p>
</blockquote>
<p>安装提示：没有找不到cc命令，需要编译环境，安装gcc,make还要安装要安装build-essential，安装了这个包会安装上g++,libc6-dev,linux-libc-dev,libstdc++6-4.1-dev等好多必须的软件和头文件。</p>
<blockquote>
<p>sudo apt install gcc<br>
sudo apt install make<br>
sudo apt-get install libprotobuf-dev libleveldb-dev libsnappy-dev libopencv-dev libboost-all-dev libhdf5-serial-dev libgflags-dev libgoogle-glog-dev liblmdb-dev protobuf-compiler<br>
sudo apt-get install build-essential</p>
</blockquote>
<p>再次安装驱动，又遇到这样的错误：</p>
<pre><code>ERROR: Unable to load the kernel module 'nvidia.ko'.  This happens most frequently when this kernel module was built against the wrong or improperly configured kernel sources, with a version of gcc that differs from the one used to build the target kernel, or if a driver such as rivafb, nvidiafb, or nouveau is present and prevents the NVIDIA kernel module from obtaining ownership of the NVIDIA graphics device(s), or no NVIDIA GPU installed in this system is supported by this NVIDIA Linux graphics driver release. Please see the log entries 'Kernel module load error' and 'Kernel messages' at the end of the file '/var/log/nvidia-installer.log' for more information.
</code></pre>
<p>查看log中显示</p>
<pre><code>Kernel module load error: No such device
</code></pre>
<p>可能是驱动版本不对，去另一个相同服务器中查看驱动信息</p>
<blockquote>
<p>nvidia-smi<br>
<img src="/2019/06/24/install_Tensorflow/180517160236.png" alt="驱动版本信息"></p>
</blockquote>
<p>驱动不是随便下的[/my fault],显卡版本是NVIDIA Tesla P100,然后下载驱动，下在过程吃到的X,都在<a target="_blank" rel="noopener" href="https://www.zhihu.com/question/277543233">这里</a><br>
下载到nvidia-diag-driver-local-repo-ubuntu1604-390.46_1.0-1_amd64.deb</p>
<blockquote>
<p>sudo dpkg -i nvidia-diag-driver-local-repo-ubuntu1604-390.46_1.0-1_amd64.deb</p>
</blockquote>
<p>出错：The public CUDA GPG key does not appear to be installed.</p>
<blockquote>
<p>sudo apt-key add /var/nvidia-diag-driver-local-repo-390.46/7fa2af80.pub</p>
</blockquote>
<p>更新总线信息update-pciids，仍然找不到英伟达显卡。</p>
<h4 id="小插曲"><a class="header-anchor" href="#小插曲">¶</a>小插曲</h4>
<p><a target="_blank" rel="noopener" href="https://github.com/little-by/journal/blob/master/Install%20NIC%20driver%20for%20Ubuntu.md">安装网卡驱动</a></p>
<p>最后发现显卡插口松动，换了一个插口后，成功查到显卡。<br>
<img src="/2019/06/24/install_Tensorflow/20180526200208.png" alt="显卡信息"></p>
<h2 id="NVIDIA驱动"><a class="header-anchor" href="#NVIDIA驱动">¶</a>NVIDIA驱动</h2>
<p>现在正式开始重新安装显卡驱动，当然上一步编译环境也是需要安装的，这里略去。<br>
去官网下载合适版本的驱动NVIDIA-Linux-x86_64-390.46.run</p>
<h3 id="1-卸载已有的驱动"><a class="header-anchor" href="#1-卸载已有的驱动">¶</a>1.卸载已有的驱动</h3>
<blockquote>
<p>sudo chmod a+x NVIDIA-Linux-x86_64-390.46.run<br>
sudo apt-get remove --purge nvidia*<br>
或者<br>
sudo ./NVIDIA-Linux-x86_64-390.48.run --uninstall</p>
</blockquote>
<h3 id="2-禁用nouveau"><a class="header-anchor" href="#2-禁用nouveau">¶</a>2.禁用nouveau</h3>
<blockquote>
<p>sudo vim /etc/modprobe.d/blacklist.conf</p>
</blockquote>
<p>添加</p>
<pre><code>blacklist nouveau   
blacklist lbm-nouveau   
options nouveau modeset=0   
alias nouveau off   
alias lbm-nouveau off  
</code></pre>
<blockquote>
<p>sudo update-initramfs -u<br>
sudo reboot</p>
</blockquote>
<h3 id="3-开始安装"><a class="header-anchor" href="#3-开始安装">¶</a>3.开始安装</h3>
<p>如果是使用桌面版的，先关掉桌面</p>
<blockquote>
<p>sudo /etc/init.d/lightdm stop</p>
</blockquote>
<p>可能有的用的不是lightdm，比如gdm，寻找对应的文件就好。</p>
<blockquote>
<p>sudo ./NVIDIA-Linux-x86_64-390.46.run</p>
</blockquote>
<p>提示：</p>
<pre><code>The distribution-provided pre-install script failed!  Are you sure you want to continue? 直接继续

nvidia-installer was forced to guess the X library path '/usr/lib' and X module path 直接OK

Install NVIDIA's 32-bit compatibility libraries? YES

Installation of the kernel module for the NVIDIA Accelerated Graphics Driver for Linux-x86_64 (version 390.46) is now complete. OK
</code></pre>
<p>安装完成，重启</p>
<p>使用nvidia-smi 验证是否安装成功<br>
<img src="/2019/06/24/install_Tensorflow/20180526214933.png" alt="nvidia-smi"></p>
<h2 id="CUDA工具包9-0"><a class="header-anchor" href="#CUDA工具包9-0">¶</a>CUDA工具包9.0</h2>
<p>在 <a target="_blank" rel="noopener" href="https://developer.nvidia.com/cuda-90-download-archive?target_os=Linux&amp;target_arch=x86_64&amp;target_distro=Ubuntu&amp;target_version=1604&amp;target_type=runfilelocal">官网</a> 下载CUDA的安装包<br>
以.run文件为例</p>
<h3 id="首先还是删除之前的安装文件"><a class="header-anchor" href="#首先还是删除之前的安装文件">¶</a>首先还是删除之前的安装文件</h3>
<blockquote>
<p>sudo dpkg -l|grep -i cuda<br>
sudo dpkg --purge 对应文件名</p>
</blockquote>
<h3 id="安装CUDA"><a class="header-anchor" href="#安装CUDA">¶</a>安装CUDA</h3>
<p>CUDA(Compute Unified Device Architecture)是一个并行计算框架，它使GPU可以解决复杂计算问题。详见<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/CUDA/1186262?fr=aladdin">CUDA百度词条</a></p>
<p>依次安装，CUDA和两个不定</p>
<blockquote>
<p>sudo ./cuda_9.0.176_384.81_linux.run<br>
sudo ./cuda_9.0.176.1_linux.run<br>
sudo ./cuda_9.0.176.2_linux.run</p>
</blockquote>
<pre><code>Default Install Location of CUDA Toolkit

Windows platform:

%ProgramFiles%\NVIDIA GPU Computing Toolkit\CUDA\v#.#

Linux platform:

/usr/local/cuda-#.#

Mac platform:

/Developer/NVIDIA/CUDA-#.#
</code></pre>
<p>安装过程：</p>
<p>鉴于已经安装过显卡驱动，就不再安装了。</p>
<pre><code>Install NVIDIA Accelerated Graphics Driver for Linux-x86_64 384.81?
(y)es/(n)o/(q)uit: n

Install the CUDA 9.0 Toolkit?
(y)es/(n)o/(q)uit: y

Enter Toolkit Location
 [ default is /usr/local/cuda-9.0 ]:
</code></pre>
<p>创建符号链接，方便操作</p>
<pre><code>Do you want to install a symbolic link at /usr/local/cuda?
(y)es/(n)o/(q)uit: y

Install the CUDA 9.0 Samples?
(y)es/(n)o/(q)uit: y

Enter CUDA Samples Location
 [ default is /home/tank ]: /home/tank/soft/cuda/samples
</code></pre>
<p><img src="/2019/06/24/install_Tensorflow/20180527161940.png" alt="安装成功"></p>
<h3 id="安装完成切记要配置环境变量"><a class="header-anchor" href="#安装完成切记要配置环境变量">¶</a>安装完成切记要配置环境变量</h3>
<p><img src="/2019/06/24/install_Tensorflow/20180527221538.png" alt="cuda环境变量"></p>
<p>在/etc/environment 添加CUDA的bin目录和LD_LIBRARY_PATH，并目录还要写在PATH中</p>
<pre><code>LD_LIBRARY_PATH=/usr/local/cuda-9.0/lib64
CUDA_INSTALL=/usr/local/cuda-9.0/bin
PATH=&quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:CUDA_INSTALL&quot;
</code></pre>
<p>在 ~/.bashrc中添加一行</p>
<blockquote>
<p>source /etc/environment</p>
</blockquote>
<h2 id="cuDNN-v7-0"><a class="header-anchor" href="#cuDNN-v7-0">¶</a>cuDNN v7.0</h2>
<p>cuDNN（CUDA Deep Neural Network),在CUDA基础上对神经网络操作进行了优化。</p>
<p>根据 <a target="_blank" rel="noopener" href="https://developer.download.nvidia.com/compute/machine-learning/cudnn/secure/v7.0.5/prod/Doc/cuDNN-Installation-Guide.pdf?JIY5GnH27caTvPNzmrbEvafUAVdNSYnb317wkRK0rEVYqw8LjUpqixJseLQvuoFas7kvp6EADq6DyST5snSSdYPPgK7RcVNHyqXli1rpFCeyTDm0bK9ZOZ0ZH7dlbS9eAM400YrgpkKXl2W8pA_6b7oobN1PUNsibUecOT2jgpTAAxIYRCRqXvOMx9wNjKJbog">官方文档</a><br>
<img src="/2019/06/24/install_Tensorflow/20180527165705.png" alt="安装步骤"></p>
<p><a target="_blank" rel="noopener" href="https://developer.nvidia.com/rdp/cudnn-archive">下载网址</a>，需要注册NVIDIA开发者账号，下载如下三个文件<br>
<img src="/2019/06/24/install_Tensorflow/20180527170128.png" alt="下载列表"></p>
<blockquote>
<p>sudo dpkg -i libcudnn7_7.0.5.15-1+cuda9.0_amd64.deb<br>
sudo dpkg -i libcudnn7-dev_7.0.5.15-1+cuda9.0_amd64.deb<br>
sudo dpkg -i libcudnn7-doc_7.0.5.15-1+cuda9.0_amd64.deb</p>
</blockquote>
<p>验证是否安装成功</p>
<p><img src="/2019/06/24/install_Tensorflow/20180527170857.png" alt="verifying"></p>
<p>运行一个示例程序</p>
<blockquote>
<p>cp -r /usr/src/cudnn_samples_v7/ ~/soft/cudnn/cudnn_samples_v7<br>
cd ~/soft/cudnn/mnistCUDNN/<br>
make clean &amp;&amp; make<br>
./mnistCUDNN</p>
</blockquote>
<p>报错：</p>
<pre><code> error while loading shared libraries: libcudart.so.9.0: cannot open shared object file: No such file or directory
</code></pre>
<p>解决方法：</p>
<pre><code>在 /etc/ld.so.conf.d/加入文件 cuda.conf, 内容如下
/usr/local/cuda-6.5/lib64  
</code></pre>
<p>试用以下命令使之生效。</p>
<blockquote>
<p>sudo ldconfig</p>
</blockquote>
<p>再次运行 ./mnistCUDNN ,出现Test passed!，测试通过。<br>
官网提供的说明说要按照NVIDIA文档配置CUDA_HOME，但是文档里没有写，在网上查到配置方法</p>
<blockquote>
<p>CUDA_HOME=/usr/local/cuda</p>
</blockquote>
<p>或者</p>
<blockquote>
<p>CUDA_HOME=/usr/local/cuda-9.0</p>
</blockquote>
<p>这是因为在安装过程中选择了创建符号链接可以用cuda代指cuda-9.0文件</p>
<p>并在PATH中添加</p>
<blockquote>
<p>$CUDA_HOME/bin</p>
</blockquote>
<p>所以修改环境变量如下</p>
<pre><code>LD_LIBRARY_PATH=/usr/local/cuda-9.0/lib64
CUDA_HOME=/usr/local/cuda-9.0
PATH=&quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:$CUDA_HOME/bin&quot;
</code></pre>
<h2 id="libcupti-dev-库"><a class="header-anchor" href="#libcupti-dev-库">¶</a>libcupti-dev 库</h2>
<p>这是 NVIDIA CUDA 分析工具接口<br>
官网提供了以下命令，但是提示找不到包</p>
<blockquote>
<p>sudo apt-get install cuda-command-line-tools</p>
</blockquote>
<p>但这个命令会报找不到package的错。<br>
网上大部分解决方案是使用以下命令</p>
<blockquote>
<p>sudo apt-get install cuda-command-line-tools-9-0</p>
</blockquote>
<p>但是我使用Ubuntu-16.04,这个方法并不能解决问题，仍然报找不到包的错误。<br>
解决方法如下，但是似乎CUPTI已经和CUDA一起安装了，没有必要在安装了。以下经供参考,个人觉得官方文档没有及时更新，这个版本已经没有必要单独安装cupti，可以查看到ls /usr/local/cuda/extras/CUPTI/lib64/ 里边是有文件的，以下的命令似乎直接重装了一遍CUDA。</p>
<pre><code>curl -O http://developer.download.nvidia.com/compute/cuda/repos/ubuntu1604/x86_64/cuda-9-0_9.0.176-1_amd64.deb
如果报错，安装所有依赖包
sudo dpkg -i ./cuda-9-0_9.0.176-1_amd64.deb
sudo apt-get update
sudo apt-get install cuda-9-0
</code></pre>
<p>将/usr/local/cuda/extras/CUPTI/lib64/ 添加到LD_LIBRARY_PATH，现在我们的环境变量如下：</p>
<pre><code>LD_LIBRARY_PATH=/usr/local/cuda-9.0/lib64:/usr/local/cuda/extras/CUPTI/lib64
CUDA_HOME=/usr/local/cuda-9.0
PATH=&quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:$CUDA_HOME/bin&quot;
</code></pre>
<h2 id="SUMMARY"><a class="header-anchor" href="#SUMMARY">¶</a>SUMMARY</h2>
<p>至此，安装Tensorflow的准备工作完成，总结一下：<br>
先后安装</p>
<ul>
<li><a href="#nvidia%E9%A9%B1%E5%8A%A8">NVIDIA驱动</a></li>
<li><a href="#CUDA%E5%B7%A5%E5%85%B7%E5%8C%8590">CUDA工具包9.0</a></li>
<li><a href="#cudnn-v70">cuDNN v7.0</a></li>
<li><a href="#libcupti-dev-%E5%BA%93">libcupti-dev 库（其实已经随cuda一起安装完成）</a></li>
</ul>
<p>环境变量中需要添加</p>
<pre><code>LD_LIBRARY_PATH=/usr/local/cuda-9.0/lib64:/usr/local/cuda/extras/CUPTI/lib64  
CUDA_HOME=/usr/local/cuda-9.0
</code></pre>
<p>并将$CUDA_HOME/bin 添加到PATH</p>
<ul>
<li>主要参考：
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/cuda/cuda-installation-guide-linux/#runfile-nouveau-ubuntu">CUDA TOOLKIT DOCUMENTATION</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.download.nvidia.com/compute/cuda/9.0/Prod/docs/sidebar/CUDA_Installation_Guide_Linux.pdf">NVIDIA CUDA INSTALLATION GUIDE FOR LINUX</a></li>
<li><a target="_blank" rel="noopener" href="https://www.tensorflow.org/install/install_linux#InstallingAnaconda">在 Ubuntu 上安装 TensorFlow</a></li>
</ul>
</li>
</ul>
<h1>二、安装Tensorflow</h1>
<pre><code>官网提供了三种方式安装
</code></pre>
<ul>
<li>Virtualenv</li>
<li>“原生”pip</li>
<li>Docker</li>
<li>Anaconda</li>
<li>从源代码安装</li>
</ul>
<p>我选择使用Anaconda安装</p>
<h2 id="安装Anaconda"><a class="header-anchor" href="#安装Anaconda">¶</a>安装Anaconda</h2>
<p>从<a target="_blank" rel="noopener" href="https://www.anaconda.com/download/">Anaconda官网</a>下载3.6安装包</p>
<pre><code>Conda是一个开源的包、环境管理器，可以用于在同一个机器上安装不同版本的软件包及其依赖，并能够在不同的环境之间切换。Anaconda包括Conda、Python等180多个科学包及其依赖项。
</code></pre>
<h3 id="安装Anaconda-v2"><a class="header-anchor" href="#安装Anaconda-v2">¶</a>安装Anaconda</h3>
<blockquote>
<p>sudo chmod a+x Anaconda3-5.1.0-Linux-x86_64.sh<br>
sudo ./Anaconda3-5.1.0-Linux-x86_64.sh</p>
</blockquote>
<p>创建过程会提示安装目录、是否将变更环境变量的命令写在~/.bashrc、是否安装VSCode</p>
<p>我选择配置环境变量,安装完之后运行一下以下命令。</p>
<blockquote>
<p>source ~/.bashrc</p>
</blockquote>
<h3 id="创建tensorflow的conda环境"><a class="header-anchor" href="#创建tensorflow的conda环境">¶</a>创建tensorflow的conda环境</h3>
<blockquote>
<p>conda create -n tensorflow pip python=3.6 #注意版本</p>
</blockquote>
<p>运行出错，提示CondaHTTPError: HTTP 000 CONNECTION FAILED for url<br>
解决：添加国内源</p>
<blockquote>
<p>conda config --add channels <a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/msys2/">https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/msys2/</a><br>
conda config --add channels <a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge/">https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge/</a><br>
conda config --add channels <a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/">https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/</a><br>
conda config --set show_channel_urls yes</p>
</blockquote>
<p>没有解决，原来是机房没流量了<sub>/</sub><br>
再运行<code>conda create -n tensorflow pip python=3.6</code>,运行成功。</p>
<p>激活Conda环境</p>
<blockquote>
<p>source activate tensorflow</p>
</blockquote>
<h2 id="安装tensorflow"><a class="header-anchor" href="#安装tensorflow">¶</a>安装tensorflow</h2>
<p>在<a target="_blank" rel="noopener" href="https://www.tensorflow.org/install/install_linux#the_url_of_the_tensorflow_python_package">官网</a>找到对应版本链接,我选择用python3.6版本的tensorflow1.6的支持GPU的版本</p>
<blockquote>
<p>(tensorflow) tank@gpu2:~/soft/tensorflow$ pip install --ignore-installed --upgrade <a target="_blank" rel="noopener" href="https://storage.googleapis.com/tensorflow/linux/gpu/tensorflow_gpu-1.6.0-cp36-cp36m-linux_x86_64.whl">https://storage.googleapis.com/tensorflow/linux/gpu/tensorflow_gpu-1.6.0-cp36-cp36m-linux_x86_64.whl</a></p>
</blockquote>
<h2 id="验证安装"><a class="header-anchor" href="#验证安装">¶</a>验证安装</h2>
<p>激活容器</p>
<blockquote>
<p>source activate tensorflow</p>
</blockquote>
<p>进入python shell</p>
<blockquote>
<p>python</p>
</blockquote>
<p>输入示例程序</p>
<pre><code>import tensorflow as tf
hello = tf.constant('Hello, TensorFlow!')
sess = tf.Session()
print(sess.run(hello))
</code></pre>
<p>得到结果</p>
<p><img src="/2019/06/24/install_Tensorflow/20180528112744.png" alt="tensorflow验证结果"></p>
<hr>
<h1>更新</h1>
<p>安装cuda 11.0+cuddnn8 后测试编译报错找不到FreeImage.h，安装一下就可以解决。</p>
<blockquote>
<p>sudo apt-get install libfreeimage3 libfreeimage-dev$$</p>
</blockquote>
<ul>
<li>主要参考：
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/ada0915/article/details/78529877">conda源</a></li>
<li><a target="_blank" rel="noopener" href="https://www.tensorflow.org/install/install_linux#InstallingAnaconda">在 Ubuntu 上安装 TensorFlow</a></li>
</ul>
</li>
</ul>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Kotar Zhang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://little-by.github.io/2019/06/24/install_Tensorflow/">http://little-by.github.io/2019/06/24/install_Tensorflow/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://little-by.github.io" target="_blank">Kotara</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/img/cover/hr1.jpg" data-sites="wechat,weibo,qq,facebook,twitter"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat_shoukuan.png" target="_blank"><img class="post-qr-code-img" src="/img/wechat_shoukuan.png" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/ali_shangjia.png" target="_blank"><img class="post-qr-code-img" src="/img/ali_shangjia.png" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2019/06/24/NVIDIA_Docker/"><img class="prev-cover" src="/img/cover/hr8.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">NVIDIA_Docker</div></div></a></div><div class="next-post pull-right"><a href="/2019/06/24/Install_NIC_driver_for_Ubuntu/"><img class="next-cover" src="/img/cover/hr3.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Install_NIC_driver_for_Ubuntu</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></article></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By Kotar Zhang</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Welcome to my blog!</div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><div class="js-pjax"><script>if (document.getElementsByClassName('mermaid').length) {
  if (window.mermaidJsLoad) mermaid.init()
  else {
    $.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js', function () {
      window.mermaidJsLoad = true
      mermaid.initialize({
        theme: 'default',
      })
      false && mermaid.init()
    })
  }
}</script><script>function loadValine () {
  function initValine () {
    const initData = {
      el: '#vcomment',
      appId: 'XIzcLKSUeyWp7rdTG70S1xcq-gzGzoHsz',
      appKey: 'wDmzsW5rFnsFzR7elD6QCC4f',
      placeholder: 'Please leave your footprints (Nickname &amp; E-Mail)',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: true,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: true,
      path: window.location.pathname,
    }

    if (true) { 
      initData.requiredFields= ('nick,mail'.split(','))
    }

    const valine = new Valine(initData)
  }

  if (typeof Valine === 'function') initValine() 
  else $.getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js', initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.querySelector('#vcomment'),loadValine)
  else setTimeout(() => loadValine(), 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script></div></body></html>