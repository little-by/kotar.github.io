<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>install_and_learn_Docker | Kotara</title><meta name="author" content="Kotar Zhang"><meta name="copyright" content="Kotar Zhang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="搭建docker，学习官方文档 想要了解Docker的一些特性，这篇文章很有帮助。 安装过程参考docker docs 一、安装docker ¶1.首先卸载旧版的docker（如果有的话）  sudo apt remove docker docker-engine docker.io  ¶2.SET UP THE REPOSITORY  sudo apt update sudo apt insta">
<meta property="og:type" content="article">
<meta property="og:title" content="install_and_learn_Docker">
<meta property="og:url" content="http://little-by.github.io/2019/06/24/install_and_learn_Docker/index.html">
<meta property="og:site_name" content="Kotara">
<meta property="og:description" content="搭建docker，学习官方文档 想要了解Docker的一些特性，这篇文章很有帮助。 安装过程参考docker docs 一、安装docker ¶1.首先卸载旧版的docker（如果有的话）  sudo apt remove docker docker-engine docker.io  ¶2.SET UP THE REPOSITORY  sudo apt update sudo apt insta">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://little-by.github.io/img/cover/hr1.jpg">
<meta property="article:published_time" content="2019-06-24T15:34:22.000Z">
<meta property="article:modified_time" content="2019-08-23T07:24:33.000Z">
<meta property="article:author" content="Kotar Zhang">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://little-by.github.io/img/cover/hr1.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://little-by.github.io/2019/06/24/install_and_learn_Docker/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '5.2.0',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Kotar Zhang","link":"链接: ","source":"来源: Kotara","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  ClickShowText: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2019-08-23 15:24:33'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {
  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }

  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }
})()</script><meta name="generator" content="Hexo 5.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">40</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">23</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div id="body-wrap"><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">一、安装docker</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E9%A6%96%E5%85%88%E5%8D%B8%E8%BD%BD%E6%97%A7%E7%89%88%E7%9A%84docker%EF%BC%88%E5%A6%82%E6%9E%9C%E6%9C%89%E7%9A%84%E8%AF%9D%EF%BC%89"><span class="toc-number">1.1.</span> <span class="toc-text">1.首先卸载旧版的docker（如果有的话）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-SET-UP-THE-REPOSITORY"><span class="toc-number">1.2.</span> <span class="toc-text">2.SET UP THE REPOSITORY</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85docker-ce"><span class="toc-number">1.3.</span> <span class="toc-text">安装docker ce</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81"><span class="toc-number">1.4.</span> <span class="toc-text">验证</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BA%86%E6%97%A0%E9%9C%80%E6%AF%8F%E6%AC%A1%E9%83%BD%E8%BE%93%E5%85%A5sudo-%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84%E7%94%A8%E6%88%B7%E7%BB%84"><span class="toc-number">1.4.1.</span> <span class="toc-text">为了无需每次都输入sudo ,创建新的用户组</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">二、Get started</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Container-%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AAapp"><span class="toc-number">2.1.</span> <span class="toc-text">Container 搭建一个app</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AADockerfile"><span class="toc-number">2.1.1.</span> <span class="toc-text">创建一个Dockerfile</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86requirements-txt-%E5%92%8C-app-py-%E6%94%BE%E5%9C%A8%E5%90%8C%E4%B8%80%E7%9B%AE%E5%BD%95%E4%B8%8B"><span class="toc-number">2.1.2.</span> <span class="toc-text">将requirements.txt 和 app.py 放在同一目录下</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C"><span class="toc-number">2.1.3.</span> <span class="toc-text">运行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E4%BA%ABimage"><span class="toc-number">2.1.4.</span> <span class="toc-text">分享image</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Service"><span class="toc-number">2.2.</span> <span class="toc-text">Service</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-compose-yml"><span class="toc-number">2.2.1.</span> <span class="toc-text">docker-compose.yml</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%9A%84app"><span class="toc-number">2.2.2.</span> <span class="toc-text">运行负载均衡的app</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Swarm"><span class="toc-number">2.3.</span> <span class="toc-text">Swarm</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E9%9B%86%E7%BE%A4"><span class="toc-number">2.3.1.</span> <span class="toc-text">1.创建一个集群</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E5%AE%89%E8%A3%85%E8%99%9A%E6%8B%9F%E6%9C%BAvirtualbox%EF%BC%8C%E4%BB%A5%E6%94%AF%E6%8C%81hypervisor"><span class="toc-number">2.3.1.1.</span> <span class="toc-text">（1）安装虚拟机virtualbox，以支持hypervisor</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%AE%89%E8%A3%85docker-compose%E5%92%8Cdocker-machine"><span class="toc-number">2.3.1.2.</span> <span class="toc-text">(2)安装docker-compose和docker-machine</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#a-docker-compose"><span class="toc-number">2.3.1.2.1.</span> <span class="toc-text">a. docker-compose</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#b-docker-machine"><span class="toc-number">2.3.1.2.2.</span> <span class="toc-text">b. docker-machine</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="toc-number">2.3.1.3.</span> <span class="toc-text">(3)创建虚拟机</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%88%9D%E5%A7%8B%E5%8C%96swarm%E5%92%8C%E5%85%B6%E8%8A%82%E7%82%B9"><span class="toc-number">2.3.1.4.</span> <span class="toc-text">(4)初始化swarm和其节点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8swarm%E9%9B%86%E7%BE%A4%E4%B8%8A%E9%83%A8%E7%BD%B2app"><span class="toc-number">2.3.2.</span> <span class="toc-text">在swarm集群上部署app</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E9%85%8D%E7%BD%AE%E4%B8%80%E4%B8%AAdocke-machine-shell"><span class="toc-number">2.3.2.1.</span> <span class="toc-text">（2）配置一个docke-machine shell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%883%EF%BC%89%E5%BC%80%E5%A7%8B%E9%83%A8%E7%BD%B2"><span class="toc-number">2.3.2.2.</span> <span class="toc-text">（3）开始部署</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Stacks"><span class="toc-number">2.4.</span> <span class="toc-text">Stacks</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AA%E6%96%B0Service%E5%B9%B6%E9%87%8D%E6%96%B0%E9%83%A8%E7%BD%B2"><span class="toc-number">2.4.1.</span> <span class="toc-text">添加一个新Service并重新部署</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">Summary</span></a></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(/img/cover/hr1.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Kotara</a></span><span id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">install_and_learn_Docker</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2019-06-24T15:34:22.000Z" title="发表于 2019-06-24 23:34:22">2019-06-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2019-08-23T07:24:33.000Z" title="更新于 2019-08-23 15:24:33">2019-08-23</time></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><p>搭建docker，学习官方文档</p>
<p>想要了解Docker的一些特性，这篇<a target="_blank" rel="noopener" href="https://blog.csdn.net/u012422829/article/details/54930799">文章</a>很有帮助。</p>
<p>安装过程参考<a target="_blank" rel="noopener" href="https://docs.docker.com/install/linux/docker-ce/ubuntu/">docker docs</a></p>
<h1>一、安装docker</h1>
<h2 id="1-首先卸载旧版的docker（如果有的话）"><a class="header-anchor" href="#1-首先卸载旧版的docker（如果有的话）">¶</a>1.首先卸载旧版的docker（如果有的话）</h2>
<blockquote>
<p>sudo apt remove docker docker-engine <a target="_blank" rel="noopener" href="http://docker.io">docker.io</a></p>
</blockquote>
<h2 id="2-SET-UP-THE-REPOSITORY"><a class="header-anchor" href="#2-SET-UP-THE-REPOSITORY">¶</a>2.SET UP THE REPOSITORY</h2>
<blockquote>
<p>sudo apt update<br>
sudo apt install apt-transport-https ca-certificates curl sofeware-properties-common<br>
curl -fsSL <a target="_blank" rel="noopener" href="https://download.docker.com/linux/ubuntu/gpg">https://download.docker.com/linux/ubuntu/gpg</a> | sudo apt-key add -</p>
</blockquote>
<p>验证</p>
<blockquote>
<p>sudo apt-key fingerprint 0EBFCD88</p>
</blockquote>
<p>SET UP THE STABLE REPOSITORY</p>
<blockquote>
<p>sudo add-apt-repository “deb [arch=amd64] <a target="_blank" rel="noopener" href="https://download.docker.com/linux/ubuntu">https://download.docker.com/linux/ubuntu</a> $(lsb_release -cs) stable”</p>
</blockquote>
<a id="more"></a>
<h2 id="安装docker-ce"><a class="header-anchor" href="#安装docker-ce">¶</a>安装docker ce</h2>
<blockquote>
<p>sudo apt update<br>
sudo apt install docker-ce</p>
</blockquote>
<h2 id="验证"><a class="header-anchor" href="#验证">¶</a>验证</h2>
<blockquote>
<p>sudo docker run hello-world</p>
</blockquote>
<p>一些docker操作的命令</p>
<pre><code>sudo docker images 
## 可以查看已经下载的镜像
sudo docker rmi IMAGEID
## 删除他特定的镜像
sudo docker ps -a
## 可以查看创建的所有的容器
sudo docker stop  $(sudo docker ps -a -q)
## 停止所有容器
sudo docker stop  $(sudo docker ps -a -q)
## 删除所有容器
</code></pre>
<h3 id="为了无需每次都输入sudo-创建新的用户组"><a class="header-anchor" href="#为了无需每次都输入sudo-创建新的用户组">¶</a>为了无需每次都输入sudo ,创建新的用户组</h3>
<blockquote>
<p>sudo groupadd docker ## 可能提示已经创建过，可能是安装过程已经创建</p>
</blockquote>
<p>将当前用户添加到用户组</p>
<blockquote>
<p>sudo usermod -aG docker $USER</p>
</blockquote>
<p>注销在登陆后，就可以不输入sudo 运行docker</p>
<h1>二、Get started</h1>
<h2 id="Container-搭建一个app"><a class="header-anchor" href="#Container-搭建一个app">¶</a>Container 搭建一个app</h2>
<p>cd 到一个空目录</p>
<h3 id="创建一个Dockerfile"><a class="header-anchor" href="#创建一个Dockerfile">¶</a>创建一个Dockerfile</h3>
<pre><code># Use an official Python runtime as a parent image
FROM python:2.7-slim

# Set the working directory to /app
WORKDIR /app

# Copy the current directory contents into the container at /app
ADD . /app

# Install any needed packages specified in requirements.txt
RUN pip install --trusted-host pypi.python.org -r requirements.txt

# Make port 80 available to the world outside this container
EXPOSE 80

# Define environment variable
ENV NAME World

# Run app.py when the container launches
CMD [&quot;python&quot;, &quot;app.py&quot;]
</code></pre>
<h3 id="将requirements-txt-和-app-py-放在同一目录下"><a class="header-anchor" href="#将requirements-txt-和-app-py-放在同一目录下">¶</a>将requirements.txt 和 <a target="_blank" rel="noopener" href="http://app.py">app.py</a> 放在同一目录下</h3>
<p>requirements.txt</p>
<pre><code>Flask
Redis
</code></pre>
<p><a target="_blank" rel="noopener" href="http://app.py">app.py</a></p>
<pre><code>from flask import Flask
from redis import Redis, RedisError
import os
import socket

# Connect to Redis
redis = Redis(host=&quot;redis&quot;, db=0, socket_connect_timeout=2, socket_timeout=2)

app = Flask(__name__)

@app.route(&quot;/&quot;)
def hello():
    try:
        visits = redis.incr(&quot;counter&quot;)
    except RedisError:
        visits = &quot;&lt;i&gt;cannot connect to Redis, counter disabled&lt;/i&gt;&quot;

    html = &quot;&lt;h3&gt;Hello &#123;name&#125;!&lt;/h3&gt;&quot; \
           &quot;&lt;b&gt;Hostname:&lt;/b&gt; &#123;hostname&#125;&lt;br/&gt;&quot; \
           &quot;&lt;b&gt;Visits:&lt;/b&gt; &#123;visits&#125;&quot;
    return html.format(name=os.getenv(&quot;NAME&quot;, &quot;world&quot;), hostname=socket.gethostname(), visits=visits)

if __name__ == &quot;__main__&quot;:
    app.run(host='0.0.0.0', port=80)
</code></pre>
<h3 id="运行"><a class="header-anchor" href="#运行">¶</a>运行</h3>
<p>然后再Dockerfile所在目录执行如下命令</p>
<blockquote>
<p>docker bild -t friendlyhello</p>
</blockquote>
<p>运行app</p>
<blockquote>
<p>docker  run -p 4000:80 friendlyhello</p>
</blockquote>
<p>访问主机4000端口可以得到网页返回内容</p>
<blockquote>
<p>curl <a target="_blank" rel="noopener" href="http://localhost:4000">http://localhost:4000</a></p>
</blockquote>
<h3 id="分享image"><a class="header-anchor" href="#分享image">¶</a>分享image</h3>
<p>登陆docker账号</p>
<p><img src="/2019/06/24/install_and_learn_Docker/20180604201648.png" alt="登陆"></p>
<p>本地的镜像通过username/repository:tag这样的规则关联起来<br>
给镜像打标签</p>
<blockquote>
<p>docker tag friendlyhello kotar/get-started:part2</p>
</blockquote>
<p>查看现在的镜像</p>
<p><img src="/2019/06/24/install_and_learn_Docker/20180604203519.png" alt="images"></p>
<p>上传刚才打过标签的镜像到云端仓库</p>
<p><img src="/2019/06/24/install_and_learn_Docker/20180604204210.png" alt="错误"></p>
<p>错误的原因是，username必须是最初登陆的那一个，随便起一个的话会去找别人的库，当然没有权限。重新上传一下。</p>
<p><img src="/2019/06/24/install_and_learn_Docker/20180604204624.png" alt="成功"></p>
<hr>
<hr>
<h2 id="Service"><a class="header-anchor" href="#Service">¶</a>Service</h2>
<p>为了衡量app并实现负载均衡，我们必须上升到service层，Services are really just “containers in production.” service，它包括了一个镜像，可以定义镜像运行的端口，副本数量等。其实是container运行过程中的别称。<br>
衡量一个service的容量，以便于在运行时给他分配相应的资源。<br>
docker中使用docker-compose.yml定义运行和衡量services。</p>
<h3 id="docker-compose-yml"><a class="header-anchor" href="#docker-compose-yml">¶</a>docker-compose.yml</h3>
<p>一个例子</p>
<pre><code>version: &quot;3&quot;
services:
  web:
    # replace dockerkotar/get-started:part2 with your name and image details
    image: dockerkotar/get-started:part2
    deploy:
      replicas: 5
      resources:
        limits:
          cpus: &quot;0.1&quot;
          memory: 50M
      restart_policy:
        condition: on-failure
    ports:
      - &quot;80:80&quot;
    networks:
      - webnet
networks:
  webnet:
</code></pre>
<ul>
<li>使用之前创建的镜像</li>
<li>运行五个实例作为一个叫web的service，每个最多使用10%的CPU core和50M内存</li>
<li>将主机的80端口映射到web的80端口</li>
<li>web中的容器通过一个负载均衡网络（webnet）共享端口80（在内部，容器本身在临时端口上发布到web的端口80）。</li>
<li>webnet 使用默认设置，（负载均衡的overlay网络）</li>
</ul>
<h3 id="运行负载均衡的app"><a class="header-anchor" href="#运行负载均衡的app">¶</a>运行负载均衡的app</h3>
<blockquote>
<p>docker swarm init</p>
</blockquote>
<p><img src="/2019/06/24/install_and_learn_Docker/20180604213101.png" alt="swarm init"></p>
<p>(下一部分会讲解，不运行这个命令会有“this node is not a swarm manager”错误)<br>
运行</p>
<blockquote>
<p>docker stack deploy -c docker-compose.yml getstartedlab</p>
</blockquote>
<p><img src="/2019/06/24/install_and_learn_Docker/20180604214152.png" alt="deploy"></p>
<p>现在程序在一个节点运行了五个实例</p>
<p>查看service id</p>
<blockquote>
<p>docker service ls</p>
</blockquote>
<p><img src="/2019/06/24/install_and_learn_Docker/20180604215312.png" alt="service"></p>
<p>service 中的每一个container叫做一个task，每一个task被赋于一个唯一的ID，可以使用以下命令查看</p>
<blockquote>
<p>docker service ps getstartedlab_web</p>
</blockquote>
<p><img src="/2019/06/24/install_and_learn_Docker/20180604215223.png" alt="Task"></p>
<p>访问app几次，查看效果</p>
<blockquote>
<p>curl -4 <a target="_blank" rel="noopener" href="http://localhost">http://localhost</a></p>
</blockquote>
<p><img src="/2019/06/24/install_and_learn_Docker/20180604215850.png" alt="web res"></p>
<p>hostname 会变化，是考虑到了负载均衡</p>
<p>最后关闭app和swarm</p>
<blockquote>
<p>docker stack rm getstartedlab<br>
docker swarm leave --force</p>
</blockquote>
<p><img src="/2019/06/24/install_and_learn_Docker/20180604220405.png" alt="shutdown"></p>
<hr>
<hr>
<h2 id="Swarm"><a class="header-anchor" href="#Swarm">¶</a>Swarm</h2>
<p>A swarm is a group of machines that are running Docker and joined into a cluster.<br>
swarm就是一组运行docker的机器组成的集群，这个机器可以是物理机也可以是虚拟机。<br>
Swarm managers是集群中执行命令和授权其他机器作为worker加入集群的机器。<br>
（这里我有疑问，既然已经docker有那么多优点，和虚拟机不同，不需要装操作系统等，但这里操作的时候为什么又要依赖virtualbox，感觉这样就浪费了docker的优势。可能是我的理解还不够深入，继续研究）</p>
<h3 id="1-创建一个集群"><a class="header-anchor" href="#1-创建一个集群">¶</a>1.创建一个集群</h3>
<h4 id="（1）安装虚拟机virtualbox，以支持hypervisor"><a class="header-anchor" href="#（1）安装虚拟机virtualbox，以支持hypervisor">¶</a>（1）安装虚拟机virtualbox，以支持hypervisor</h4>
<p>在 /etc/apt/sources.list 中添加（mydist替换成codename，ubuntu16.04是xenial（可以通过<code>cat /etc/os-release</code>查看<br>
））</p>
<pre><code>deb https://download.virtualbox.org/virtualbox/debian &lt;mydist&gt; contrib
</code></pre>
<p>添加keys</p>
<blockquote>
<p>wget -q <a target="_blank" rel="noopener" href="https://www.virtualbox.org/download/oracle_vbox_2016.asc">https://www.virtualbox.org/download/oracle_vbox_2016.asc</a> -O- | sudo apt-key add -<br>
wget -q <a target="_blank" rel="noopener" href="https://www.virtualbox.org/download/oracle_vbox.asc">https://www.virtualbox.org/download/oracle_vbox.asc</a> -O- | sudo apt-key add -</p>
</blockquote>
<p>安装virtualbox</p>
<blockquote>
<p>sudo apt-get update<br>
sudo apt-get install virtualbox-5.2</p>
</blockquote>
<h4 id="2-安装docker-compose和docker-machine"><a class="header-anchor" href="#2-安装docker-compose和docker-machine">¶</a>(2)安装docker-compose和docker-machine</h4>
<h5 id="a-docker-compose"><a class="header-anchor" href="#a-docker-compose">¶</a>a. docker-compose</h5>
<p>参考安装docker-compose的<a target="_blank" rel="noopener" href="https://docs.docker.com/compose/install/">官方文档</a></p>
<blockquote>
<p>sudo curl -L <a target="_blank" rel="noopener" href="https://github.com/docker/compose/releases/download/1.21.2/docker-compose-$">https://github.com/docker/compose/releases/download/1.21.2/docker-compose-$</a>(uname -s)-$(uname -m) -o /usr/local/bin/docker-compose</p>
</blockquote>
<p>安装command completion for the bash and zsh</p>
<p>先有的版本command completion for bash 已经可用<br>
只安装command completion for zsh</p>
<blockquote>
<p>mkdir -p ~/.zsh/completion<br>
curl -L <a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/docker/compose/1.21.2/contrib/completion/zsh/_docker-compose">https://raw.githubusercontent.com/docker/compose/1.21.2/contrib/completion/zsh/_docker-compose</a> &gt; ~/.zsh/completion/_docker-compose</p>
</blockquote>
<p>在~/.zshrc中添加$fpath</p>
<pre><code>fpath=(~/.zsh/completion $fpath)
</code></pre>
<p>确保compinit被加载在~/.zshrc中添加</p>
<blockquote>
<p>autoload -Uz compinit &amp;&amp; compinit -i</p>
</blockquote>
<p>重启shell</p>
<blockquote>
<p>exec $SHELL -l</p>
</blockquote>
<p>然后验证docker-compose的安装</p>
<blockquote>
<p>docker-compose --version</p>
</blockquote>
<p>如果能够正确的输出版本信息就表示成功</p>
<h5 id="b-docker-machine"><a class="header-anchor" href="#b-docker-machine">¶</a>b. docker-machine</h5>
<p>docker-machine 是一个管理和供应docker化的hosts的工具。可以用docker-machine 安装docker到一个或者多个虚拟系统中（可以是远程或本地，ubuntu,windows,mac）,docker化的主机本省可以被认为是一个machine。</p>
<p><img src="/2019/06/24/install_and_learn_Docker/1805162246.png" alt="docker-machine"></p>
<p>安装docker-machine</p>
<p>下载docker-machine，然后安装到/usr/local/bin/docker-machine</p>
<blockquote>
<p>base=https://github.com/docker/machine/releases/download/v0.14.0 &amp;&amp;<br>
curl -L $base/docker-machine-$(uname -s)-$(uname -m) &gt;/tmp/docker-machine &amp;&amp;<br>
sudo install /tmp/docker-machine /usr/local/bin/docker-machine</p>
</blockquote>
<p>检查docker-machine是否安装成功。</p>
<blockquote>
<p>docker-machine version</p>
</blockquote>
<p>安装bash completion scripts，运行以下命令</p>
<pre><code>base=https://raw.githubusercontent.com/docker/machine/v0.14.0
for i in docker-machine-prompt.bash docker-machine-wrapper.bash docker-machine.bash
do
	sudo wget &quot;$base/contrib/completion/bash/$&#123;i&#125;&quot; -P /etc/bash_completion.d
done
</code></pre>
<p>然后使之生效</p>
<blockquote>
<p>source /etc/bash_completion.d/docker-machine-prompt.bash</p>
</blockquote>
<p>修改~/.bashrc,添加 $(__docker_machine_ps1) 到 PS1 变量 (如何添加现在还不清楚，我把它添加到了最前部)</p>
<pre><code>PS1='[\u@\h \W$(__docker_machine_ps1)]\$ '
</code></pre>
<h4 id="3-创建虚拟机"><a class="header-anchor" href="#3-创建虚拟机">¶</a>(3)创建虚拟机</h4>
<blockquote>
<p>docker-machine create --driver virtualbox myvm1</p>
</blockquote>
<blockquote>
<p>docker-machine create --driver virtualbox myvm2</p>
</blockquote>
<p><img src="/2019/06/24/install_and_learn_Docker/20180610202431.png" alt="install vms"></p>
<p>安装到这里我解决了之前的疑问（既然已经docker有那么多优点，和虚拟机不同，不需要装操作系统等，但这里操作的时候为什么又要依赖virtualbox，不是又要创建虚拟机装系统吗，感觉这样就浪费了docker的优势。），查看创建虚拟机时的输出信息，你会发现虚拟机中安装的系统不是普通linux镜像，而是一个叫做boot2docker.iso的镜像。<br>
到boot2docker官方网页可以看到</p>
<pre><code>boot2docker is a lightweight Linux distribution based on Tiny Core Linux made specifically to run Docker containers. It runs completely from RAM, weighs ~27MB and boots in ~5s

boot2docker是一个轻量级的linux分布式系统，其基于Tiny Core Linux，是为了运行docker容器专门打造的。它完全运行在内存中，27MB的大小，五秒之内就可以启动。
</code></pre>
<p>查看虚拟机，获取他们的IP</p>
<blockquote>
<p>docker-machine ls</p>
</blockquote>
<p><img src="/2019/06/24/install_and_learn_Docker/20180610205142.png" alt="docker-machine ls"></p>
<h4 id="4-初始化swarm和其节点"><a class="header-anchor" href="#4-初始化swarm和其节点">¶</a>(4)初始化swarm和其节点</h4>
<p>将第一个虚拟机作为manager，将第二个作为worker。</p>
<blockquote>
<p>docker-machine ssh myvm1 “docker swarm init --advertise-addr 192.168.99.100:2376”</p>
</blockquote>
<p><img src="/2019/06/24/install_and_learn_Docker/20180610230740.png" alt="docker-machine ssh manager"></p>
<p>使用2376端口添加worker的时候错误，建议改用2377，说明如下：</p>
<pre><code>Always run docker swarm init and docker swarm join with port 2377 (the swarm management port), or no port at all and let it take the default.

The machine IP addresses returned by docker-machine ls include port 2376, which is the Docker daemon port. Do not use this port or you may experience errors.
</code></pre>
<p>把刚才的swarm manager退出</p>
<blockquote>
<p>docker-machine ssh myvm1 “docker swarm leave --force”</p>
</blockquote>
<p>然后重新创建</p>
<blockquote>
<p>docker-machine ssh myvm1 “docker swarm init --advertise-addr 192.168.99.100:2377”</p>
</blockquote>
<p>把myvm2加入作为worker 注意重新创建后token已经变化。</p>
<blockquote>
<p>docker-machine ssh myvm2 “docker swarm join --token SWMTKN-1-14wh5kn71lnx5r72o29ppdrhq3h1fu2qk37pwtejexis0hrnwc-3h7zhw9ero8i212e7v2x2h28p 192.168.99.100:2377”</p>
</blockquote>
<p><img src="/2019/06/24/install_and_learn_Docker/20180610232301.png" alt="add worker"></p>
<p>使用docker node ls在manager节点查看集群中的节点</p>
<blockquote>
<p>docker-machine ssh myvm1 “docker node ls”</p>
</blockquote>
<p><img src="/2019/06/24/install_and_learn_Docker/20180610232812.png" alt="nodes"></p>
<p>以上就是一个简单的集群</p>
<h3 id="在swarm集群上部署app"><a class="header-anchor" href="#在swarm集群上部署app">¶</a>在swarm集群上部署app</h3>
<h4 id="（2）配置一个docke-machine-shell"><a class="header-anchor" href="#（2）配置一个docke-machine-shell">¶</a>（2）配置一个docke-machine shell</h4>
<p>上边几步都是通过docker-machine ssh操作虚拟机的，然而这样操作有点麻烦。<br>
另一种可以替代的选择是使用docker-machine env <machine>,这种方法允许使用本地的docker-compose.yml来部署app</machine></p>
<blockquote>
<p>docker-machine env myvm1</p>
</blockquote>
<p><img src="/2019/06/24/install_and_learn_Docker/20180611212238.png" alt="env myvm1"></p>
<p>然后运行以上结果输出命令的最后一行（去掉井号）</p>
<blockquote>
<p>eval $(docker-machine env myvm1)</p>
</blockquote>
<p>然后运行dockers-machine ls命令确认myvm1是否是active</p>
<blockquote>
<p>docker-machine ls</p>
</blockquote>
<p><img src="/2019/06/24/install_and_learn_Docker/20180611213227.png" alt="docker-machine ls"></p>
<p>配置完之后既可以连接到myvm1，又可以访问本地的文件。</p>
<p>如果想重置env</p>
<blockquote>
<p>eval $(docker-machine env -u)</p>
</blockquote>
<h4 id="（3）开始部署"><a class="header-anchor" href="#（3）开始部署">¶</a>（3）开始部署</h4>
<p>部署的命令和使用的云端镜像都是service部分的。<br>
找到上一部分使用的docker-compose.yml的目录，然后u</p>
<blockquote>
<p>docker stack deploy -c docker-compose.yml getstartedlab</p>
</blockquote>
<p>试用以下命令查看集群中的task（也就是container）</p>
<blockquote>
<p>docker stack ps getstartedlab</p>
</blockquote>
<p><img src="/2019/06/24/install_and_learn_Docker/20180611223301.png" alt="docker stack deploy"></p>
<p>使用docker-machine ls 查看虚拟机的IP，然后使用curl访问他们两个之中任意一个</p>
<blockquote>
<p>docker-machine ls<br>
curl 192.168.99.100</p>
</blockquote>
<p>会看到返回的html源码</p>
<p>多访问几次，会发现五个container都能访问到，这是因为swarm中的nodes加入了一个ingress routing mesh，其效果如下</p>
<p><img src="/2019/06/24/install_and_learn_Docker/20180611224617.png" alt="ingress network"></p>
<hr>
<hr>
<h2 id="Stacks"><a class="header-anchor" href="#Stacks">¶</a>Stacks</h2>
<p>stack是一组相关联的services，他们共享以来可以统一调度。stack是分布式app的最高层。</p>
<p>之前在Service部分运行的stack是单一service在单一host，到这在实际操作中并不常见，这一部分就要部署一个多Service的应用。</p>
<h3 id="添加一个新Service并重新部署"><a class="header-anchor" href="#添加一个新Service并重新部署">¶</a>添加一个新Service并重新部署</h3>
<p>添加一个service–visualizer，添加后的docker-compose.yml如下：</p>
<pre><code>version: &quot;3&quot;
services:
    web:
        # replace dockerkotar/get-started:part2 with your name and image details
        image: dockerkotar/get-started:part2
        deploy:
            replicas: 5
            restart_policy:
                condition: on-failure
            resources:
                limits:
                    cpus: &quot;0.1&quot;
                    memory: 50M
        ports:
            - &quot;80:80&quot;
        networks:
            - webnet
    visualizer:
        image: dockersamples/visualizer:stable
        ports:
            - &quot;8080:8080&quot;
        volumes:
            - &quot;/var/run/docker.sock:/var/run/docker.sock&quot;
        deploy:
            placement:
                constraints: [node.role == manager]
        networks:
            - webnet
networks:
    webnet:
</code></pre>
<p>volumes 中的属性让visualizer可以访问主机的socket文件</p>
<p>placement限定了仅在manager结点运行</p>
<p>确认docker配置到了myvm1的环境（eval $(docker-machine env myvm1)）<br>
重新部署以下app</p>
<p>如果没有移除之前在service部分创建的应用，先将其移除，不然会引起端口占用错误。</p>
<blockquote>
<p>docker stack rm getstartedlab</p>
</blockquote>
<p>然后部署</p>
<blockquote>
<p>docker stack deploy -c docker-compose.yml getstaetedlab</p>
</blockquote>
<p>（部署的时候遇到了yaml语法错误，注意：yaml使用缩进表示层级，层级不能乱，而且禁止使用tab缩进）</p>
<p>访问visualizer</p>
<p><img src="/2019/06/24/install_and_learn_Docker/20180612225717.png" alt="visualizer"></p>
<p>docker的学习告一段落，官网还有使用AWS部署docker的教程以后再看。</p>
<hr>
<hr>
<h1>Summary</h1>
<ul>
<li>
<p><a href="#%E4%B8%80%E5%AE%89%E8%A3%85docker">安装docker</a></p>
<ul>
<li><a href="#1%E9%A6%96%E5%85%88%E5%8D%B8%E8%BD%BD%E6%97%A7%E7%89%88%E7%9A%84docker%E5%A6%82%E6%9E%9C%E6%9C%89%E7%9A%84%E8%AF%9D">首先卸载旧版的docker</a></li>
<li><a href="#2set-up-the-repository">SET UP THE REPOSITORY</a></li>
</ul>
</li>
<li>
<p><a href="#%E4%BA%8Cget-started">get-started</a></p>
<ul>
<li><a href="#container-%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AAapp">使用container-搭建一个app</a></li>
<li><a href="#service">service</a></li>
<li><a href="#swarm">swarm</a></li>
<li><a href="#stacks">stacks</a></li>
</ul>
</li>
</ul>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Kotar Zhang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://little-by.github.io/2019/06/24/install_and_learn_Docker/">http://little-by.github.io/2019/06/24/install_and_learn_Docker/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://little-by.github.io" target="_blank">Kotara</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/img/cover/hr1.jpg" data-sites="wechat,weibo,qq,facebook,twitter"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat_shoukuan.png" target="_blank"><img class="post-qr-code-img" src="/img/wechat_shoukuan.png" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/ali_shangjia.png" target="_blank"><img class="post-qr-code-img" src="/img/ali_shangjia.png" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2019/06/24/install_caffe/"><img class="prev-cover" src="/img/cover/hr10.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">install_caffe</div></div></a></div><div class="next-post pull-right"><a href="/2019/06/24/Distributed_Tensorflow/"><img class="next-cover" src="/img/cover/hr6.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Distributed_Tensorflow</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></article></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By Kotar Zhang</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Welcome to my blog!</div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><div class="js-pjax"><script>if (document.getElementsByClassName('mermaid').length) {
  if (window.mermaidJsLoad) mermaid.init()
  else {
    $.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js', function () {
      window.mermaidJsLoad = true
      mermaid.initialize({
        theme: 'default',
      })
      false && mermaid.init()
    })
  }
}</script><script>function loadValine () {
  function initValine () {
    const initData = {
      el: '#vcomment',
      appId: 'XIzcLKSUeyWp7rdTG70S1xcq-gzGzoHsz',
      appKey: 'wDmzsW5rFnsFzR7elD6QCC4f',
      placeholder: 'Please leave your footprints (Nickname &amp; E-Mail)',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: true,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: true,
      path: window.location.pathname,
    }

    if (true) { 
      initData.requiredFields= ('nick,mail'.split(','))
    }

    const valine = new Valine(initData)
  }

  if (typeof Valine === 'function') initValine() 
  else $.getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js', initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.querySelector('#vcomment'),loadValine)
  else setTimeout(() => loadValine(), 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script></div></body></html>